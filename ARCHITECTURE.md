# YouTube 视频问答系统架构

## 系统架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                        前端界面 (HTML/JS)                        │
│                    http://localhost:8080                        │
└─────────────────────┬───────────────────────────────────────────┘
                      │ HTTP API
┌─────────────────────▼───────────────────────────────────────────┐
│                    Go Web服务 (Gin)                            │
│                    - 路由处理                                   │
│                    - 数据库操作                                 │
│                    - 静态文件服务                               │
│                    - API网关                                    │
└─────────────────────┬───────────────────────────────────────────┘
                      │ HTTP调用
┌─────────────────────▼───────────────────────────────────────────┐
│                  Python AI服务 (FastAPI)                       │
│                    - 视频内容分析                               │
│                    - AI问答处理                                 │
│                    - 百度千帆API集成                            │
│                    - YouTube API集成                            │
└─────────────────────┬───────────────────────────────────────────┘
                      │ API调用
┌─────────────────────▼───────────────────────────────────────────┐
│                    外部服务                                      │
│              - 百度千帆API (AI模型)                            │
│              - YouTube Data API (视频信息)                     │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│                     SQLite数据库                                │
│              - 视频信息 (videos)                               │
│              - 视频片段 (video_segments)                      │
│              - 聊天记录 (chat_messages)                        │
└─────────────────────────────────────────────────────────────────┘
```

## 核心组件

### 1. 前端界面
- **技术栈**: HTML5 + Bootstrap 5 + JavaScript
- **功能**: 
  - 视频库管理界面
  - 实时聊天界面
  - 视频播放集成
  - 响应式设计

### 2. Go Web服务
- **技术栈**: Go + Gin框架 + GORM
- **功能**:
  - RESTful API接口
  - 数据库操作
  - 静态文件服务
  - 与Python服务通信

### 3. Python AI服务
- **技术栈**: Python + FastAPI + httpx
- **功能**:
  - 视频内容分析
  - AI问答处理
  - 百度千帆API集成
  - YouTube API集成

### 4. 数据库
- **技术**: SQLite + GORM
- **表结构**:
  - `videos`: 视频基本信息
  - `video_segments`: 视频片段分析
  - `chat_messages`: 聊天记录

## 数据流程

### 添加视频流程
1. 用户输入YouTube URL
2. Go服务提取视频ID
3. 调用Python服务获取视频信息
4. 异步分析视频内容生成片段
5. 保存到数据库

### 问答流程
1. 用户输入问题
2. Go服务转发到Python服务
3. Python服务调用百度千帆API
4. AI分析问题并返回答案
5. 如有相关视频片段，提供时间戳
6. 保存聊天记录

## API接口

### Go服务API
- `GET /` - 主页
- `GET /api/videos` - 获取视频列表
- `POST /api/videos` - 添加视频
- `DELETE /api/videos/:id` - 删除视频
- `POST /api/chat` - 发送问题
- `GET /api/chat/history` - 获取聊天历史

### Python服务API
- `GET /` - 健康检查
- `GET /video/{video_id}` - 获取视频信息
- `POST /video/{video_id}/analyze` - 分析视频内容
- `POST /chat` - 处理问答

## 部署方式

### 本地开发
```bash
# 安装依赖
make install

# 启动服务
./start_new.sh
```

### Docker部署
```bash
# 使用Docker Compose
docker-compose up -d
```

## 配置说明

### 环境变量
- `PORT`: Go服务端口 (默认8080)
- `GIN_MODE`: Gin运行模式
- `YOUTUBE_API_KEY`: YouTube API密钥 (可选)
- 百度千帆API密钥在代码中配置

### 数据库
- 使用SQLite，文件名为`ytchat.db`
- 自动创建表结构
- 支持数据迁移

## 扩展功能

### 已实现
- ✅ 视频库管理
- ✅ 智能问答
- ✅ 视频片段定位
- ✅ 实时聊天界面
- ✅ AI内容分析

### 可扩展
- 🔄 用户系统
- 🔄 视频推荐
- 🔄 批量导入
- 🔄 多语言支持
- 🔄 移动端适配
